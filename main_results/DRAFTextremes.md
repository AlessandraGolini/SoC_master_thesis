# Compound flooding analysis
## Extreme events
### Univariate extreme analysis
#### Block Maxima approach

When analysing maximum river discharge or heighest water level in a given time period, it is common to model not just the extremes observed, but to quantify probabilities of rare extremes. A common approach to practical extreme value analysis is to use the Generalized Extreme Value Distribution (GEV) to fit to the observed extreme values. In fact, extreme value theory provides the statistical foundation for this task. A central result of this theory, the Fisher–Tippett–Gnedenko theorem, demonstrates that, for a sequence of independent random variables having a common distribution function, the distribution of the normalized largest value over a fixed period of time (known as the block maxima), converges to a family of distributions known as GEV distribution (Coles, 2001, §3). 

In hydrology, the Block Maxima (BM) approach is widely applied. This method consists of dividing the observation record into non-overlapping periods of equal length and restricts attention to the maximum observation in each block. The resulting series of annual maxima is then fitted with the GEV distribution, allowing the estimation for return levels, defined as quantiles corresponding to specidic return periods. In this way, observed extremes are associated with probabilities, and extrapolation beyond the observed record becomes possible. It should be said, however, that while GEV distribution provides the theoretical foundation for modeling block maxima, its derivation assumes underlying stationarity. Coles (2001, §6) emphasizes that environmental processes rarely satisfy this assumption due to seasonal cycles and long-term trends. Therefore, for non-stationary sequencies it's necessary either remove such structure (e.g. through detrended anomalies) or incorporate it explicitly in a non-stationary GEV model with time- or season-dependent parameters.

In practice, the data here are divided into annual blocks, from which only the annual maximum value is considered, creating a shorter series of 12 values for 2010-2021. The GEV distribution is then fitted to these annual maxima, with shape, location and scale parameters estimated through maxima likelihood estimation (MLE). Then, the return periods are computed as the reciprocal of exceedance probability, T = 1/p. The corresponding return level q = 1 - 1/T is the quantile of the fitted GEV distribution that is exceeded with probability 1/T in any given year (Coles, 2001, §3.2).

In the code, once the GEV parameters are estimated, each observed annual maximum is assigned to an *empirical return period* using the Weibull plotting position: Temp = (n+1)/m, where n is the number of annual maxima and m is the rank of the maximum (from the largest = 1, to the smallest = n). Ath the same time, the fitted GEV is used to compute the theoretical return level curve across a smooth grid of return periods up to a safe maximum (≈3× record length).

Lastly, the comparison of the empirical estimates from data (points) with the fitted model (curve) is here paralelly proposed for both the raw time series and the detrended anomalies.

<img width="1189" height="397" alt="immagine" src="https://github.com/user-attachments/assets/f50d06d8-8d56-4b1e-84b5-c5ea4385f4ec" />
<img width="1189" height="397" alt="immagine" src="https://github.com/user-attachments/assets/725e768b-a0dc-49ec-be05-3161a13310c4" />
These two sets of plots illustrate the difference between fitting a GEV model to raw non-stationary data versus to detrended anomalies.

The first row illustrates the empirical return levels for the raw time series of river discharge (to the left) and water level (to the right). The first panel, top row to the left, shows that the empirical points (blue dots), representing the return level assigned to each observed annual maximum usign the Weibull plotting position, are clustered near the bottom of the graph. Instead, the GV fit (red curve) suddenly shoots up almost vertically for return periods beyond ~20 years. The explosion of return levels is a symptom of unstable GEV fits due to non-stationarity, and of short BM series (12 annual maxima). This means that these extrapolations are not realistic because the model is trying to force-fit a heavy tail with too little data.

On the other hand, the top right panel shows the return levels for raw water level. This looks much more stable: the red curve traks the empirical points quite well, and extrapolates smoothly. In fact, return levels increase gradually, which is physically reasonable, since water level extremes usually have natural limits (e.g., coastal geometry, hydraulic controls, climate variability). For example, a 2-year return period corresponds to a small exceedance (close to the average annual maximum). A 10-year return period is a bit higher, while a 30-year return period is higher still, but the increase is progressive, and not explosive. This physical reasonability suggests that water level series is closer to stationary, so the GEV fit works better than for river diacharge raw data. However, the empirical values of return level for raw water level clearly deviate from the GEV fit curve, suggesting that the assumption of stationarity, at the basis of the theory of extreme values, is not respected. This behavior could be attributed to the presence of trends or seasonality in the time series, which compromise the quality of the fit. For this reason , it could be convinient to consider the detrended anomalies.

In fact, in the second row it can be seen that detrended anomalies give a much more reasonable fit, both for river discharge and water level. Moreover, for river discharge detrended anomalies, not only the red curve follows the empirical points closely, but also the extrapolation to higher return periods looks stable. This suggests that the removal of long-term non-stationary components through detrending improves the model performance and yields results more consistent with the theoretical assumptions of extreme value analysis (Coles, 2001, §6).


In any case, it is relevant that the block maxima series is very short, with only 12 years of data. This implies that the Maximum Likelihood Estimation method to estiamte the GEV parameters is very unstable, which is evident in the Volta Estuary River dicharge Return Levels for raw data: here the GEV curve explodes upwards very fast, wich is an unrealistic extrapolation. Therefore, for short records such as the one considered, it is convinent to use Probability Weighted Moments (or L-moments), which is a much more robust method with short hydrological recors, and which produces more stable and realistic return levels.

<img width="1189" height="397" alt="immagine" src="https://github.com/user-attachments/assets/61368b80-29f5-44f0-aa4f-13e56dc0fea9" />
<img width="1189" height="397" alt="immagine" src="https://github.com/user-attachments/assets/4c7dd0cb-ab49-4cb8-85e6-db76141e586e" />

This result alines with what is described by the theory: Coles (2001, §3.4) notes that estimation of the GEV shape parameter ξ is particularly sensitive to sample size, and large uncertainties in ξ translate into unstable extrapolations of return levels. For the previous case, where the shape parameter was estimated by Maximum Lkelihood Estimation, the return level curve for discharge in the raw dataset steeply diverged, exploding to unreasonable high values very fast. By contrast, the L-moments approach (Hosking, 1990) provides estimators that are less efficient asymptotically but much more robust for small samples, making them especially suitable in hydrological applications such as the present one where records are typically short. In the present case, the L-moment based GEV fits yield smoother return level curves, which follow the empirical points more closely and avoid the unrealistic ‘explosive’ behaviour observed with MLE.

Looking to the detrende anomalies of river discharge, the GEV fit curve well follows empirical values at low frequencies (with small T, 1-5 years), while tends to sistematically underestimate return levels at the tails (for large T, >10 years). This is an expected behaviour for short datasets, since the highest extremes are few and can generate considerable oscillations, whereas the mean GEV tends to smooth them. Still, it is important to note that the fit seems to be stable, as an increasing monotonic curve that do not explode as for the MLE case. In the case of water level detrended anomalies, nhere are no major discrepancies between the fitted GEV and the empirical return levels. This could be a sign that the theoretical distribution manages to capture the dynamics of the sea level extremes well, once the non-stationarity of the original series has been removed with detrending. The extrapolation is consistent also for longer return periods, with a gradual increase.

Both panels show that, once trends and seasonality have been eliminated (detrended anomalies), the GEV estimate with L-moments provides a relatively more stable and theoretically consistent fit. However, the GEV curve is estimated here on an extremely small sample, since the dataset spans only over 12 years (2010-2021). The Block Maxima approach, then, implieas a significant loss of information, since it only uses annual maxima, ignoring all other extreme events that might happen in the same year. In small datasets, as the one in exam, modeling only block maxima is a wasteful approach to extreme value analysis, because great part of the information contained in the series is discarded (Coles, 2001). This highly limits the GEV capability to well represent the tail distribution of extremes, leading to eventual underestimates or overestimates of the return periods, expecially for the longer ones (>10 years). To avoid this limit, and estimate return periods of 15-30 years in a robust way, it is convinient to consider another extreme analysis method.

#### Peaks-over-threshold approach

An alternative to the block maxima approach is the Peaks-Over-Threshold (POT) method, which avoids discharding potentially useful information by considering all observations that exceed a sufficiently high threshold. Instead of retaining only the single maximum value within each block (e.g., one per year), the POT approach models the **distribution of threshold exceedances**. Extreme value theory shows that, for a suitably high threshold, the distribution of excesses over the threshold converges to the Generalized Pareto Distribution (GPD), that is the theoretical distribution of threshold exceedances (Coles, 2001, §5.3). Thus, the POT method provides a more efficient use of the data, since multiple extreme observations within the same year may be included, rather than only the annual maximum.

In hydrological applications, the POT method is particularly valuable when the observation record is relatively short, as this is our case, or when several significant flood peaks occur within a single year. A key practical challenge, however, is the choice of threshold: it must be high enough for the GPD approximation to hold, yet low enough to retain a sufficient number of exceedances for reliable inference (Naess, 2024). This challenge is even more relevant since the data series is non-stationary: both the river discharge and the water level raw time series present a strong seasonality and interannual variability. The non-stationarity of the data undermines a fundamental premise in the extreme values therory: the stationary of independent and identically distributed random variables (Coles, 2001, §4.1). To overcome this non-stationarity incongruence, the peak-over-threshold analysis is carried out considering detrended anomalies, as they better align with the theoretical GEV distribution with respect to raw data (see BM analysis).

In practice, the POT analysis starts with finding a suitable threshold for the selected data.
 
to be reviewd: A widely used strategy is to set the threshold at a high empirical quantile of the series, typically between the 95th and 99th percentiles (Coles, 2001, §4.3). Diagnostic tools help to verify the adequacy of the chosen threshold: the mean residual life plot (also known as the mean excess plot) should show approximate linearity above the threshold, while plots of the estimated GPD parameters (shape ξ and scale σ) against a range of candidate thresholds should stabilize when the threshold is high enough (Coles, 2001; Scarrott & MacDonald, 2012). To ensure that threshold exceedances are approximately independent, a declustering procedure is often applied, where exceedances within a specified “run length” are grouped into a cluster and only the maximum is retained (Ferro & Segers, 2003; Süveges, 2007). The choice of run length can be supported by examining inter-exceedance times and estimating the extremal index, which provides a measure of the degree of clustering in extremes.

Once independent exceedances are extracted, the excesses are fitted to the GPD using maximum likelihood or L-moments estimation. The fitted GPD parameters allow for the estimation of return levels and exceedance probabilities that are more robust than those derived from block maxima, especially when the observation record is short (Coles, 2001; Beirlant et al., 2004). Importantly, because the series analyzed here are based on detrended anomalies rather than raw values, the threshold exceedances can be assumed closer to fulfilling the i.i.d. requirement of EVT, which strengthens the validity of the GPD approximation.

In hydrological and coastal applications, where extremes are often seasonally modulated, a stationary threshold may not always be adequate. In such cases, time-varying thresholds—for example, rolling percentiles computed within a moving seasonal window or thresholds estimated by quantile regression—are recommended to account for changes in exceedance frequency over the seasonal cycle (Eastoe & Tawn, 2009; Northrop & Coleman, 2014). However, in this study, we first apply stationary thresholds to the detrended anomalies and only consider seasonally varying thresholds if diagnostic checks (e.g., monthly exceedance rates, parameter instability) suggest their necessity.

Do you want me to als


